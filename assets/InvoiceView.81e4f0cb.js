import{_ as B,u as l,$ as e,o as t,c as i,a as n,F as p,r as m,d as k,f as E,Q as W,t as b,p as G,b as H,g as M}from"./index.d936bd5b.js";const Y={name:"InvoiceView",components:{},data(){return{userObj:l,isProjects:!1,isUsers:!1,isClients:!1,isAccounts:!1,includedColours:{},invoiceData:{},amountOfProjects:1,invoiceTotal:0,projectKeys:[],columnLetter:["A","B","C","D"],columnHeadings:["Description","Rate","Quantity","Total $"],keys:["name","rate","QTY","Total"],addToRecord:!0}},mounted(){this.$nextTick(()=>{Object.keys(l.projects).forEach((s,o)=>{let d=Object.keys(l.projects[s].weeks)[0];l.projects[s].weeks[d].invoiced?e(`#invoice_selection_alert_${o+1}`).text("This week as already been invoiced"):e(`#invoice_selection_alert_${o+1}`).text("")})}),this.isProjects=Object.keys(l.projects).length!=0,this.isUsers=Object.keys(l.users).length!=0,this.isClients=Object.keys(l.clients).length!=0,this.isAccounts=l.records.accounts.length!=0,this.isProjects&&(this.projectKeys=[],Object.keys(l.projects).forEach((s,o)=>{this.projectKeys.push(s),this.projectKeys.push(s)}))},methods:{numberWithCommas(s){return parseFloat(s).toFixed(2).replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),",")},changeProjectNum(){this.amountOfProjects=e("#amount_projects_invoice option:selected").val(),this.$nextTick(()=>{this.projectKeys.forEach((s,o)=>{let d=Object.keys(l.projects[s].weeks)[0];l.projects[s].weeks[d].invoiced?e(`#invoice_selection_alert_${o+1}`).text("This week as already been invoiced"):e(`#invoice_selection_alert_${o+1}`).text("")})})},checkInvoice(s){let o=e(`#${s.target.id} option:selected`).attr("data"),d=e(`#${s.target.id} option:selected`).attr("weekid");l.projects[o].weeks[d].invoiced?e(`#invoice_selection_alert_${s.target.id.split("_")[2]}`).text("This week as already been invoiced"):e(`#invoice_selection_alert_${s.target.id.split("_")[2]}`).text("")},changeState(){this.addToRecord=e("#invoice_add_records")[0].checked},getFirstLastDate(s){let o=[];s.forEach((c,v)=>{let a=c.split("/");a=`${a[1]}/${a[0]}/${a[2]}`;let u=new Date(a);o.push(u)});let d=o[0],f=o[0];return o.forEach((c,v)=>{c.getTime()<=d.getTime()&&(d=c),c.getTime()>=f.getTime()&&(f=c)}),[d,f]},generateInvoice(){this.invoiceTotal=0,e("#invoice_for_invoice").text(e("#invoice_for").val());let s=e("#invoice_ID").val();e("#invoice_id_invoice").text(s);let o=this.userObj.clients[e("#client_selection option:selected").attr("data")],d=this.userObj.users[e("#user_selection option:selected").attr("data")],f=new Date,c=String(f.getDate()).padStart(2,"0"),v=String(f.getMonth()+1).padStart(2,"0"),a=f.getFullYear();f=c+"/"+v+"/"+a;let u=e("#invoice_date").val()?e("#invoice_date").val().split("-")[2]+"/"+e("#invoice_date").val().split("-")[1]+"/"+e("#invoice_date").val().split("-")[0]:f;e("#invoice_date_invoice").text(u),this.invoiceData={};let r=[],y=e("#invoice_include_colours")[0].checked;for(let I=1;I<=this.amountOfProjects;I++){let _=e(`#project_selection_${I} option:selected`).attr("data"),C=e(`#project_selection_${I} option:selected`).attr("weekid");Object.keys(this.invoiceData).includes(_)||(this.invoiceData[_]={},this.invoiceData[_].projTotal=0,this.invoiceData[_].projName=l.projects[_].name),r.push(l.projects[_].weeks[C].startDate);for(const[g,S]of Object.entries(l.projects[_].weeks[C].colouredCells))if(S.length!=0||y){let N=Math.round(1/(60/l.projects[_].timeInterval)*1e3)/1e3*S.length,x=N*parseFloat(l.colours[g].rate);Object.keys(this.invoiceData[_]).includes(g)||(this.invoiceData[_][g]={QTY:0,Total:0}),this.invoiceData[_][g].name=l.colours[g].name,this.invoiceData[_][g].rate=l.colours[g].rate,this.invoiceData[_][g].QTY+=N,this.invoiceData[_][g].Total+=x,this.invoiceData[_].projTotal+=x,this.invoiceTotal+=x}}let j=this.getFirstLastDate(r),h=j[0],D=new Date(j[1]);D.setDate(j[1].getDate()+13);let T=["00","0",""],O=T[h.getDate().toString().length]+h.getDate().toString(),P=T[(h.getMonth()+1).toString().length]+(h.getMonth()+1).toString(),A=T[D.getDate().toString().length]+D.getDate().toString(),F=T[(D.getMonth()+1).toString().length]+(D.getMonth()+1).toString(),L=`${O}/${P}/${h.getFullYear()} to ${A}/${F}/${D.getFullYear()}`;e("#invoice_date_period").text(L),e("#user_name_invoice").text(d.name),e("#user_addOne_invoice").text(d.addOne),e("#user_addTwo_invoice").text(d.addTwo),e("#user_city_invoice").text(d.city),e("#user_country_invoice").text(d.country),e("#user_contact_invoice").text(d.contact),e("#client_id_invoice").text(o.client),e("#client_name_invoice").text(o.name),e("#client_addOne_invoice").text(o.addOne),e("#client_addTwo_invoice").text(o.addTwo),e("#client_city_invoice").text(o.city),e("#client_country_invoice").text(o.country),setTimeout(()=>{this.printInvoice()},1)},printInvoice(s="invoice_page"){let o='<title>Print Preview</title><link rel="shortcut icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTE5IDhINWMtMS42NiAwLTMgMS4zNC0zIDN2Nmg0djRoMTJ2LTRoNHYtNmMwLTEuNjYtMS4zNC0zLTMtM3ptLTMgMTFIOHYtNWg4djV6bTMtN2MtLjU1IDAtMS0uNDUtMS0xcy40NS0xIDEtMSAxIC40NSAxIDEtLjQ1IDEtMSAxem0tMS05SDZ2NGgxMlYzeiIvPjwvc3ZnPg==">';o+='<link rel="stylesheet" href="/invoicePrint.css" />',o+='<body onload="window.focus(); window.print()">'+e("#"+s).html()+"</body>";let d=window.open("","_blank","width=900,height=900,nodeIntegration=yes");d&&(d.document.write(o),d.document.close())}}},w=s=>(G("data-v-3df24e5b"),s=s(),H(),s),$={class:"pageHome"},V={class:"form_container"},z={class:"form",style:{background:"radial-gradient(circle, #35a2ff 0%, #014a88 100%)"}},Q={id:"top"},R={class:"side"},U=w(()=>n("label",{for:"amount_projects_invoice"},"Number of Projects To Invoice:",-1)),Z={key:1,class:"advisory"},K={class:"project_selection_container"},J=["for"],q=["id"],X=["data","weekid"],ee=["id"],te={class:"side"},ie=w(()=>n("label",{for:"user_selection"},"Choose a User:",-1)),oe={key:0,id:"user_selection"},se=["data"],ce={key:1,class:"advisory"},ae=w(()=>n("label",{for:"client_selection"},"Choose a Client:",-1)),ne={key:2,id:"client_selection"},de=["data"],le={key:3,class:"advisory"},re=M('<label for="invoice_date" data-v-3df24e5b>Invoice Date:</label><input id="invoice_date" type="date" data-v-3df24e5b><label for="invoice_for" data-v-3df24e5b>Invoice For:</label><input id="invoice_for" type="text" data-v-3df24e5b><label for="invoice_ID" data-v-3df24e5b>Invoice ID:</label><input id="invoice_ID" type="text" data-v-3df24e5b><label for="invoice_include_colours" data-v-3df24e5b>Include All Colours:</label><input id="invoice_include_colours" type="checkbox" data-v-3df24e5b>',8),_e={id:"invoice_page",style:{display:"none"}},ve={id:"PRINTtheTHING"},he={style:{"-webkit-print-color-adjust":"exact"},id:"invoice_sheet"},ue={class:"inner"},pe=M('<div class="top_section" data-v-3df24e5b><div class="top_left" data-v-3df24e5b><h2 id="user_name_invoice" data-v-3df24e5b></h2><p id="user_addOne_invoice" data-v-3df24e5b></p><p id="user_addTwo_invoice" data-v-3df24e5b></p><p id="user_city_invoice" data-v-3df24e5b></p><p id="user_country_invoice" data-v-3df24e5b></p><p id="user_contact_invoice" data-v-3df24e5b></p><div class="box_with_heading" data-v-3df24e5b><p data-v-3df24e5b>Client ID</p><p id="client_id_invoice" data-v-3df24e5b></p></div><div class="box_with_heading" data-v-3df24e5b><p data-v-3df24e5b>Bill To</p><p id="client_name_invoice" data-v-3df24e5b></p><p id="client_addOne_invoice" data-v-3df24e5b></p><p id="client_addTwo_invoice" data-v-3df24e5b></p><p id="client_city_invoice" data-v-3df24e5b></p><p id="client_country_invoice" data-v-3df24e5b></p></div></div><div class="top_right" data-v-3df24e5b><div class="title" data-v-3df24e5b>INVOICE</div><div class="dual_box_heading" data-v-3df24e5b><div class="box_with_heading" data-v-3df24e5b><p data-v-3df24e5b>Invoice #</p><p id="invoice_id_invoice" data-v-3df24e5b></p></div><div class="box_with_heading" data-v-3df24e5b><p data-v-3df24e5b>Date</p><p id="invoice_date_invoice" data-v-3df24e5b></p></div></div><div class="box_with_heading" data-v-3df24e5b><p data-v-3df24e5b>Invoice Period</p><p id="invoice_date_period" data-v-3df24e5b></p></div><div class="box_with_heading" data-v-3df24e5b><p data-v-3df24e5b>Invoice For</p><p id="invoice_for_invoice" data-v-3df24e5b></p></div></div></div>',1),be={class:"bottom_section"},fe={class:"bottom_section_title"},ye=["colID"],ge={class:"cell heading"},me={key:0,class:"cell"},ke=w(()=>n("div",{class:"cell"},null,-1)),je={key:0,class:"cell",style:{"border-left":"1px solid black"}},De={key:1,class:"cell",style:{"border-left":"1px solid black"}},we={key:2,class:"cell",style:{"font-weight":"600","border-left":"1px solid black"}},Te={key:3,class:"cell"},Ie={key:4,class:"cell"},xe={key:5,class:"cell",style:{"font-weight":"600"}},Ce={class:"bottom_section"},Se={class:"invoice_sheet_column"},Ne=w(()=>n("div",{class:"cell",style:{"font-weight":"600"}},"GRAND TOTAL (NZD)",-1)),Me={class:"cell",style:{"font-weight":"600"}};function Oe(s,o,d,f,c,v){return t(),i(p,null,[n("div",$,[n("div",V,[n("div",z,[n("div",Q,[n("div",R,[U,c.isProjects?(t(),i("select",{key:0,id:"amount_projects_invoice",onChange:o[0]||(o[0]=(...a)=>v.changeProjectNum&&v.changeProjectNum(...a)),style:{margin:"0px 0px 10px"}},[(t(!0),i(p,null,m(c.projectKeys,(a,u)=>(t(),i("option",{key:a},b(u+1),1))),128))],32)):(t(),i("div",Z,"Go To Settings To Create A Project")),n("div",K,[c.isProjects?(t(!0),i(p,{key:0},m(parseInt(c.amountOfProjects),(a,u)=>(t(),i("div",{key:u,class:"selection_select"},[n("label",{for:`project_selection_${a}`},"Choose a Project and Week:",8,J),n("select",{id:`project_selection_${a}`,onChange:o[1]||(o[1]=(...r)=>v.checkInvoice&&v.checkInvoice(...r))},[(t(!0),i(p,null,m(c.userObj.projects,(r,y)=>(t(),i(p,{key:r},[(t(!0),i(p,null,m(r.weeks,(j,h)=>(t(),i("option",{key:h,data:y,weekid:h},b(r.name)+" : "+b(h),9,X))),128))],64))),128))],40,q),n("p",{style:{color:"white"},id:`invoice_selection_alert_${a}`},null,8,ee)]))),128)):k("",!0)])]),n("div",te,[ie,c.isUsers?(t(),i("select",oe,[(t(!0),i(p,null,m(c.userObj.users,(a,u)=>(t(),i("option",{key:a,data:u},b(a.user),9,se))),128))])):(t(),i("div",ce,"Go To Settings To Create A User")),ae,c.isClients?(t(),i("select",ne,[(t(!0),i(p,null,m(c.userObj.clients,(a,u)=>(t(),i("option",{key:a,data:u},b(a.client),9,de))),128))])):(t(),i("div",le,"Go To Settings To Create A Client")),re])]),E(W,{class:"glossy",rounded:"",color:"primary",label:"Print Invoice",onClick:v.generateInvoice},null,8,["onClick"])])])]),n("div",_e,[n("div",ve,[n("div",he,[n("div",ue,[pe,(t(!0),i(p,null,m(c.invoiceData,(a,u)=>(t(),i("div",be,[n("span",fe,b(a.projName),1),(t(!0),i(p,null,m(c.columnLetter,(r,y)=>(t(),i("div",{key:r,colID:r,class:"invoice_sheet_column"},[n("div",ge,b(c.columnHeadings[y]),1),(t(!0),i(p,null,m(a,(j,h)=>(t(),i(p,{key:h},[h!="projTotal"&&h!="projName"?(t(),i("div",me,b(c.keys[y]=="rate"||c.keys[y]=="Total"?`$ ${v.numberWithCommas(j[c.keys[y]])}`:j[c.keys[y]]),1)):k("",!0)],64))),128)),ke,r=="C"?(t(),i("div",je,"Subtotal")):k("",!0),r=="C"?(t(),i("div",De,"Tax")):k("",!0),r=="C"?(t(),i("div",we,"Total")):k("",!0),r=="D"?(t(),i("div",Te,"$ "+b(v.numberWithCommas(a.projTotal.toFixed(2))),1)):k("",!0),r=="D"?(t(),i("div",Ie,"$ 0")):k("",!0),r=="D"?(t(),i("div",xe,"$ "+b(v.numberWithCommas(a.projTotal.toFixed(2))),1)):k("",!0)],8,ye))),128))]))),256)),n("div",Ce,[n("div",Se,[Ne,n("div",Me,"$ "+b(v.numberWithCommas(c.invoiceTotal.toFixed(2))),1)])])])])])])],64)}var Ae=B(Y,[["render",Oe],["__scopeId","data-v-3df24e5b"]]);export{Ae as default};
